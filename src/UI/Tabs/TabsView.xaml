<UserControl x:Class="MarkRead.App.UI.Tabs.TabsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:MarkRead.App.UI.Tabs"
             mc:Ignorable="d" 
             d:DesignHeight="40" d:DesignWidth="800">
    <Grid Background="{DynamicResource SurfaceBackground}">
        <Grid.ColumnDefinitions>
            <!-- Left scroll button -->
            <ColumnDefinition Width="Auto"/>
            <!-- Tab container with scrolling -->
            <ColumnDefinition Width="*"/>
            <!-- Right scroll button -->
            <ColumnDefinition Width="Auto"/>
            <!-- New tab button -->
            <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>

        <!-- Scroll Left Button -->
        <Button x:Name="ScrollLeftButton"
                Grid.Column="0"
                Content="‹"
                FontSize="18"
                Width="28"
                Height="32"
                Margin="2,4,0,4"
                Style="{DynamicResource TabScrollButtonStyle}"
                ToolTip="Scroll tabs left"
                Click="OnScrollLeftClicked"
                Visibility="Collapsed"/>

        <!-- Scrollable Tab Container -->
        <ScrollViewer x:Name="TabScrollViewer"
                      Grid.Column="1" 
                      HorizontalScrollBarVisibility="Hidden" 
                      VerticalScrollBarVisibility="Disabled"
                      PanningMode="HorizontalOnly">
            <ItemsControl x:Name="TabsContainer" 
                          ItemsSource="{Binding Tabs, RelativeSource={RelativeSource AncestorType=local:TabsView}}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel Orientation="Horizontal"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate DataType="{x:Type local:TabItem}">
                        <Border x:Name="TabBorder"
                                BorderBrush="{DynamicResource BorderColor}"
                                BorderThickness="0,0,1,0"
                                Background="{DynamicResource SurfaceSecondary}"
                                Margin="0"
                                MinWidth="120"
                                MaxWidth="200"
                                Height="32"
                                Cursor="Hand"
                                MouseLeftButtonDown="OnTabClicked">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Grid.Column="0"
                                          Text="{Binding Title}"
                                          Margin="12,6,4,6"
                                          TextTrimming="CharacterEllipsis"
                                          VerticalAlignment="Center"
                                          Foreground="{DynamicResource TextPrimary}"
                                          FontSize="13"
                                          ToolTip="{Binding Title}"/>

                                <!-- Close button - visible on hover -->
                                <Button x:Name="CloseButton"
                                       Grid.Column="1"
                                       Content="×"
                                       FontSize="16"
                                       FontWeight="Bold"
                                       Width="20"
                                       Height="20"
                                       Margin="0,0,6,0"
                                       Padding="0"
                                       VerticalAlignment="Center"
                                       Style="{DynamicResource TabCloseButtonStyle}"
                                       ToolTip="Close tab"
                                       Click="OnCloseTabClicked"
                                       Opacity="0"/>
                            </Grid>
                        </Border>
                        <DataTemplate.Triggers>
                            <!-- Active tab styling -->
                            <DataTrigger Binding="{Binding IsActive}" Value="True">
                                <Setter TargetName="TabBorder" Property="Background" Value="{DynamicResource SurfaceBackground}"/>
                                <Setter TargetName="TabBorder" Property="BorderThickness" Value="0,2,1,0"/>
                                <Setter TargetName="TabBorder" Property="BorderBrush">
                                    <Setter.Value>
                                        <SolidColorBrush Color="#3B82F6"/>
                                    </Setter.Value>
                                </Setter>
                                <Setter TargetName="CloseButton" Property="Opacity" Value="1"/>
                            </DataTrigger>
                            <!-- Hover effect - show close button -->
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="TabBorder" Property="Background" Value="{DynamicResource ThemeButtonHoverBrush}"/>
                                <Setter TargetName="CloseButton" Property="Opacity" Value="1"/>
                            </Trigger>
                        </DataTemplate.Triggers>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!-- Scroll Right Button -->
        <Button x:Name="ScrollRightButton"
                Grid.Column="2"
                Content="›"
                FontSize="18"
                Width="28"
                Height="32"
                Margin="0,4,2,4"
                Style="{DynamicResource TabScrollButtonStyle}"
                ToolTip="Scroll tabs right"
                Click="OnScrollRightClicked"
                Visibility="Collapsed"/>

        <!-- New Tab Button -->
        <Button Grid.Column="3"
               Content="+"
               FontSize="16"
               FontWeight="Bold"
               Width="32"
               Height="32"
               Margin="4"
               Style="{DynamicResource TabScrollButtonStyle}"
               ToolTip="New tab (Ctrl+T)"
               Click="OnNewTabClicked"/>
    </Grid>
</UserControl>
