<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:MarkRead.ViewModels"
             xmlns:models="clr-namespace:MarkRead.Models"
             x:Class="MarkRead.Views.SettingsPage"
             x:DataType="vm:SettingsViewModel"
             Title="Settings"
             BackgroundColor="{DynamicResource BackgroundColor}">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="24">
            
            <!-- Settings Header -->
            <Label 
                Text="Settings"
                FontSize="28"
                FontAttributes="Bold"
                TextColor="{DynamicResource TextPrimaryColor}"
                Margin="0,0,0,8" />

            <!-- Theme Section -->
            <Border 
                BackgroundColor="{DynamicResource SurfaceColor}"
                StrokeThickness="1"
                Stroke="{DynamicResource BorderColor}"
                Padding="16">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="8"/>
                </Border.StrokeShape>

                <VerticalStackLayout Spacing="16">
                    <!-- Section Title -->
                    <Label 
                        Text="Appearance"
                        FontSize="18"
                        FontAttributes="Bold"
                        TextColor="{DynamicResource TextPrimaryColor}" />

                    <!-- Theme Toggle Button -->
                    <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                        <Label 
                            Grid.Column="0"
                            Text="Theme"
                            FontSize="16"
                            TextColor="{DynamicResource TextPrimaryColor}"
                            VerticalOptions="Center" />

                        <Label 
                            Grid.Column="1"
                            Text="{Binding SelectedTheme}"
                            FontSize="14"
                            TextColor="{DynamicResource TextSecondaryColor}"
                            VerticalOptions="Center" />

                        <Button 
                            Grid.Column="2"
                            Text="{Binding ThemeDisplayText}"
                            Command="{Binding CycleThemeCommand}"
                            BackgroundColor="{DynamicResource PrimaryColor}"
                            TextColor="{DynamicResource OnPrimaryColor}"
                            Padding="20,8"
                            CornerRadius="6"
                            FontSize="14"
                            HorizontalOptions="End"
                            IsEnabled="{Binding IsSaving, Converter={StaticResource InvertedBoolConverter}}">
                            <Button.Shadow>
                                <Shadow Brush="{DynamicResource ShadowColor}"
                                        Offset="0,2"
                                        Radius="4"
                                        Opacity="0.3" />
                            </Button.Shadow>
                        </Button>
                    </Grid>

                    <!-- Theme Options (Alternative: Individual buttons) -->
                    <HorizontalStackLayout Spacing="12" Margin="0,8,0,0">
                        <Button 
                            Text="â˜€ï¸ Light"
                            Command="{Binding SetThemeCommand}"
                            CommandParameter="{x:Static models:ThemeType.Light}"
                            BackgroundColor="{DynamicResource SurfaceVariantColor}"
                            TextColor="{DynamicResource TextPrimaryColor}"
                            BorderColor="{DynamicResource BorderColor}"
                            BorderWidth="1"
                            Padding="16,8"
                            CornerRadius="6"
                            FontSize="13" />

                        <Button 
                            Text="ðŸŒ™ Dark"
                            Command="{Binding SetThemeCommand}"
                            CommandParameter="{x:Static models:ThemeType.Dark}"
                            BackgroundColor="{DynamicResource SurfaceVariantColor}"
                            TextColor="{DynamicResource TextPrimaryColor}"
                            BorderColor="{DynamicResource BorderColor}"
                            BorderWidth="1"
                            Padding="16,8"
                            CornerRadius="6"
                            FontSize="13" />

                        <Button 
                            Text="ðŸ’» System"
                            Command="{Binding SetThemeCommand}"
                            CommandParameter="{x:Static models:ThemeType.System}"
                            BackgroundColor="{DynamicResource SurfaceVariantColor}"
                            TextColor="{DynamicResource TextPrimaryColor}"
                            BorderColor="{DynamicResource BorderColor}"
                            BorderWidth="1"
                            Padding="16,8"
                            CornerRadius="6"
                            FontSize="13" />
                    </HorizontalStackLayout>

                    <!-- Theme Description -->
                    <Label 
                        FontSize="12"
                        TextColor="{DynamicResource TextSecondaryColor}"
                        Margin="0,4,0,0">
                        <Label.FormattedText>
                            <FormattedString>
                                <Span Text="Theme changes are applied instantly. " />
                                <Span Text="System" FontAttributes="Bold" />
                                <Span Text=" follows your OS appearance settings." />
                            </FormattedString>
                        </Label.FormattedText>
                    </Label>
                </VerticalStackLayout>
            </Border>

            <!-- Behavior Section -->
            <Border 
                BackgroundColor="{DynamicResource SurfaceColor}"
                StrokeThickness="1"
                Stroke="{DynamicResource BorderColor}"
                Padding="16">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="8"/>
                </Border.StrokeShape>

                <VerticalStackLayout Spacing="16">
                    <!-- Section Title -->
                    <Label 
                        Text="Behavior"
                        FontSize="18"
                        FontAttributes="Bold"
                        TextColor="{DynamicResource TextPrimaryColor}" />

                    <!-- Startup Behavior -->
                    <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                        <VerticalStackLayout Grid.Column="0" Spacing="4">
                            <Label 
                                Text="Startup Behavior"
                                FontSize="16"
                                TextColor="{DynamicResource TextPrimaryColor}" />
                            <Label 
                                Text="Choose what happens when the app starts"
                                FontSize="12"
                                TextColor="{DynamicResource TextSecondaryColor}" />
                        </VerticalStackLayout>

                        <Picker 
                            Grid.Column="1"
                            SelectedItem="{Binding StartupBehavior, Mode=TwoWay}"
                            BackgroundColor="{DynamicResource SurfaceVariantColor}"
                            TextColor="{DynamicResource TextPrimaryColor}"
                            WidthRequest="200"
                            VerticalOptions="Center">
                            <Picker.Items>
                                <x:String>Ask</x:String>
                                <x:String>RestoreSession</x:String>
                                <x:String>StartFresh</x:String>
                            </Picker.Items>
                        </Picker>
                    </Grid>

                    <!-- Default Zoom -->
                    <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                        <VerticalStackLayout Grid.Column="0" Spacing="4">
                            <Label 
                                Text="Default Zoom Level"
                                FontSize="16"
                                TextColor="{DynamicResource TextPrimaryColor}" />
                            <Label 
                                Text="{Binding DefaultZoom, StringFormat='{0:P0}'}"
                                FontSize="12"
                                TextColor="{DynamicResource TextSecondaryColor}" />
                        </VerticalStackLayout>

                        <Slider 
                            Grid.Column="1"
                            Value="{Binding DefaultZoom, Mode=TwoWay}"
                            Minimum="0.5"
                            Maximum="2.0"
                            WidthRequest="200"
                            VerticalOptions="Center" />
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <!-- Advanced Section -->
            <Border 
                BackgroundColor="{DynamicResource SurfaceColor}"
                StrokeThickness="1"
                Stroke="{DynamicResource BorderColor}"
                Padding="16">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="8"/>
                </Border.StrokeShape>

                <VerticalStackLayout Spacing="16">
                    <!-- Section Title -->
                    <Label 
                        Text="Advanced"
                        FontSize="18"
                        FontAttributes="Bold"
                        TextColor="{DynamicResource TextPrimaryColor}" />

                    <!-- Excluded Folders -->
                    <VerticalStackLayout Spacing="8">
                        <Label 
                            Text="Excluded Folders"
                            FontSize="16"
                            TextColor="{DynamicResource TextPrimaryColor}" />
                        <Label 
                            Text="Enter folder names to exclude from file tree (one per line)"
                            FontSize="12"
                            TextColor="{DynamicResource TextSecondaryColor}"
                            Margin="0,0,0,8" />
                        <Editor 
                            Text="{Binding ExcludedFoldersText, Mode=TwoWay}"
                            HeightRequest="120"
                            BackgroundColor="{DynamicResource SurfaceVariantColor}"
                            TextColor="{DynamicResource TextPrimaryColor}"
                            FontFamily="Consolas, Courier New"
                            FontSize="12" />
                    </VerticalStackLayout>
                </VerticalStackLayout>
            </Border>

            <!-- Save/Cancel Buttons -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                <Button 
                    Grid.Column="0"
                    Text="Save Settings"
                    Command="{Binding SaveSettingsCommand}"
                    BackgroundColor="{DynamicResource PrimaryColor}"
                    TextColor="{DynamicResource OnPrimaryColor}"
                    Padding="16,12"
                    CornerRadius="6"
                    FontSize="14"
                    IsEnabled="{Binding IsSaving, Converter={StaticResource InvertedBoolConverter}}">
                    <Button.Shadow>
                        <Shadow Brush="{DynamicResource ShadowColor}"
                                Offset="0,2"
                                Radius="4"
                                Opacity="0.3" />
                    </Button.Shadow>
                </Button>

                <Button 
                    Grid.Column="1"
                    Text="Reset to Defaults"
                    Command="{Binding ResetToDefaultsCommand}"
                    BackgroundColor="Transparent"
                    TextColor="{DynamicResource ErrorColor}"
                    BorderColor="{DynamicResource ErrorColor}"
                    BorderWidth="1"
                    Padding="16,12"
                    CornerRadius="6"
                    FontSize="14" />
            </Grid>

            <!-- About Section -->
            <Border 
                BackgroundColor="{DynamicResource SurfaceColor}"
                StrokeThickness="1"
                Stroke="{DynamicResource BorderColor}"
                Padding="16">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="8"/>
                </Border.StrokeShape>

                <VerticalStackLayout Spacing="12">
                    <Label 
                        Text="About"
                        FontSize="18"
                        FontAttributes="Bold"
                        TextColor="{DynamicResource TextPrimaryColor}" />

                    <Label 
                        Text="MarkRead"
                        FontSize="16"
                        FontAttributes="Bold"
                        TextColor="{DynamicResource TextPrimaryColor}" />

                    <Label 
                        Text="Modern Markdown Viewer"
                        FontSize="14"
                        TextColor="{DynamicResource TextSecondaryColor}" />

                    <Label 
                        Text="Version 1.0.0"
                        FontSize="12"
                        TextColor="{DynamicResource TextTertiaryColor}"
                        Margin="0,4,0,0" />
                </VerticalStackLayout>
            </Border>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
