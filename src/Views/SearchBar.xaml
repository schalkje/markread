<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:MarkRead.ViewModels"
             x:Class="MarkRead.Views.SearchBar"
             x:DataType="vm:SearchViewModel"
             IsVisible="{Binding IsVisible}">
    
    <Border BackgroundColor="{AppThemeBinding Light={StaticResource LightSurface}, Dark={StaticResource DarkSurface}}"
            Stroke="{AppThemeBinding Light={StaticResource LightBorderPrimary}, Dark={StaticResource DarkBorderPrimary}}"
            StrokeThickness="0,0,0,1"
            Padding="12,8">
        
        <Grid ColumnDefinitions="Auto,*,Auto,Auto,Auto,Auto,Auto">
            
            <!-- Search Icon -->
            <Label Grid.Column="0"
                   Text="ðŸ”"
                   FontSize="16"
                   VerticalOptions="Center"
                   Margin="0,0,8,0"/>
            
            <!-- Search Input -->
            <Entry Grid.Column="1"
                   Text="{Binding Query}"
                   Placeholder="Find in document..."
                   BackgroundColor="Transparent"
                   TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}"
                   PlaceholderColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}"
                   VerticalOptions="Center"
                   x:Name="SearchEntry"/>
            
            <!-- Match Count -->
            <Label Grid.Column="2"
                   Text="{Binding MatchCountText}"
                   FontSize="12"
                   TextColor="{AppThemeBinding Light={StaticResource LightTextSecondary}, Dark={StaticResource DarkTextSecondary}}"
                   VerticalOptions="Center"
                   Margin="8,0"
                   IsVisible="{Binding MatchCountText, Converter={StaticResource IsNotNullOrEmptyConverter}}"/>
            
            <!-- Previous Match Button -->
            <Button Grid.Column="3"
                    Text="â–²"
                    Command="{Binding PreviousMatchCommand}"
                    BackgroundColor="Transparent"
                    TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}"
                    FontSize="12"
                    Padding="8,4"
                    WidthRequest="32"
                    HeightRequest="32"
                    ToolTipProperties.Text="Previous match (Shift+F3)"/>
            
            <!-- Next Match Button -->
            <Button Grid.Column="4"
                    Text="â–¼"
                    Command="{Binding NextMatchCommand}"
                    BackgroundColor="Transparent"
                    TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}"
                    FontSize="12"
                    Padding="8,4"
                    WidthRequest="32"
                    HeightRequest="32"
                    ToolTipProperties.Text="Next match (F3)"/>
            
            <!-- Options -->
            <HorizontalStackLayout Grid.Column="5" Spacing="4" Margin="8,0,0,0">
                
                <!-- Case Sensitive -->
                <Button Text="Aa"
                        Command="{Binding ToggleCaseSensitiveCommand}"
                        BackgroundColor="{Binding CaseSensitive, Converter={StaticResource BoolToSearchOptionBackgroundConverter}}"
                        TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}"
                        FontSize="12"
                        Padding="8,4"
                        WidthRequest="32"
                        HeightRequest="32"
                        ToolTipProperties.Text="Match case"/>
                
                <!-- Whole Word -->
                <Button Text="ab"
                        Command="{Binding ToggleWholeWordCommand}"
                        BackgroundColor="{Binding WholeWord, Converter={StaticResource BoolToSearchOptionBackgroundConverter}}"
                        TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}"
                        FontSize="12"
                        Padding="8,4"
                        WidthRequest="32"
                        HeightRequest="32"
                        ToolTipProperties.Text="Match whole word"/>
                
                <!-- Regex -->
                <Button Text=".*"
                        Command="{Binding ToggleRegexCommand}"
                        BackgroundColor="{Binding UseRegex, Converter={StaticResource BoolToSearchOptionBackgroundConverter}}"
                        TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}"
                        FontSize="12"
                        Padding="8,4"
                        WidthRequest="32"
                        HeightRequest="32"
                        ToolTipProperties.Text="Use regular expression"/>
            </HorizontalStackLayout>
            
            <!-- Close Button -->
            <Button Grid.Column="6"
                    Text="âœ•"
                    Command="{Binding HideSearchCommand}"
                    BackgroundColor="Transparent"
                    TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}"
                    FontSize="16"
                    Padding="8,4"
                    WidthRequest="32"
                    HeightRequest="32"
                    Margin="8,0,0,0"
                    ToolTipProperties.Text="Close search (Esc)"/>
        </Grid>
    </Border>
</ContentView>
